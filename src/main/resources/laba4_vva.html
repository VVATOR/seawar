<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Лабораторная 4</title>
</head>
<body>
<script>
    var d = document;

    var name;
    var data;
    var srok;

   
    function formatDate(date) {
        var dd = date.getDate();
        if (dd < 31 && dd>=10) {dd =  dd}else{ dd =  '0'+dd};
        var mm = date.getMonth() + 1;
        if (mm < 10) mm = '0' + mm;
        var yy = date.getFullYear();
        return dd + '.' + mm + '.' + yy;
    }   

    function addRow() {
        // Считываем значения с формы
        name = d.getElementById('name').value;
        data = d.getElementById('data').value;
        srok = d.getElementById('srok').value;

        // Находим нужную таблицу
        var tbody = d.getElementById('tab1').getElementsByTagName('TBODY')[0];

        // Создаем строку таблицы и добавляем ее
        var row = d.createElement("TR");
        tbody.appendChild(row);

        // Создаем ячейки в вышесозданной строке
        // и добавляем тх
        var td1 = d.createElement("TD");
        var td2 = d.createElement("TD");
        var td3 = d.createElement("TD");
        var td4 = d.createElement("TD");
        var td5 = d.createElement("TD");

        // добавить ячейки в строку табл.
        row.appendChild(td1);
        row.appendChild(td2);
        row.appendChild(td3);
        row.appendChild(td4);
        row.appendChild(td5);

        // Наполняем ячейки
        td1.innerHTML = name;
        td2.innerHTML = data;
        td3.innerHTML = srok;

        var d_list = data.split(".");
        if (d_list.length != 3) {
            alert("Неверный формат даты")
            return;
        }

        var year = d_list[2];
        var month = d_list[1] - 1;
        var day = d_list[0];

        var dt1 = new Date(year, month, day); // время начала отпуска
        dt1.setMonth(dt1.getMonth() + 11);
        td4.innerHTML = formatDate(dt1);

        var tmp2 = new Date(year, month, day); // время конец отпуска
        tmp2.setMonth(tmp2.getMonth() + 11); 
        var dt2 = new Date(tmp2.getFullYear(),tmp2.getMonth(),tmp2.getDate()+Number(srok))
        td5.innerHTML = formatDate(dt2);
    }

    function searchPiopleInVacation() {
        var rows = d.getElementById('tab1').tBodies[0].rows;
        var rezult = "<table border='1'>";

        var dataString = d.getElementById('dataVacation').value;
        var dateFilterPart = dataString.split(".");
        for (i = 0; i < rows.length; i++) {
            var datePart = rows[i].cells[1].innerText.split("."); // дату разбили на день месяц год	
            var dt = new Date(dateFilterPart[2], dateFilterPart[1] - 1, dateFilterPart[0] * 1);

            if (datePart.length != 3) {
                alert("Неверный формат даты")
                return;
            }

            //alert("aaa\n"+rows[i].cells[3].innerText + "\n" + dataString + "\n" + rows[i].cells[4].innerText + "\n");
            if(isDateInInentervalVacation(rows[i].cells[3].innerText, formatDate(dt), rows[i].cells[4].innerText)){
                rezult += 
                    "<tr><td> " + rows[i].cells[0].innerText +
                    "</td><td>" + rows[i].cells[1].innerText +
                    "</td><td>" + rows[i].cells[2].innerText +
                    "</td><td>" + rows[i].cells[3].innerText +
                    "</td><td>" + formatDate(dt) +
                    "</td><td>" + rows[i].cells[4].innerText ;               
            }
        }
        rezult += "</table>";
        if (rezult == "")
            rezult = "Ничего не найдено";

        d.getElementById('tab11').getElementsByTagName('TBODY')[0].innerHTML = rezult;
    }

    function isDateInInentervalVacation(stringStartDate, stringCurrentDate, stringEndDate) {     
        // строку в фармате даты dd.mm.yyyy 
        // делим на массив с частями даты
        var fir = (stringStartDate+'').split('.');
        var cur = (stringCurrentDate+'').split('.');
        var sec = (stringEndDate+'').split('.');        

        // формируем строку пригодную для сравнения
        // yyyy.mm.dd      
        var f = fir[2]+''+fir[1]+''+fir[0];
        var c = cur[2]+''+cur[1]+''+cur[0];
        var s = sec[2]+''+sec[1]+''+sec[0];

        // сравниваем
        if ((f < c) && ( c < s)) {
            //alert("ДА ");
            return true;
        } else {
            //alert("НЕТ");
            return false;
        }
    }
    
    function getWeekDay(date) {
        var days = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'];
        return days[date.getMonth()];
    }

    function startVacationInMonth() {
        var rows = d.getElementById('tab1').tBodies[0].rows;
        var ob = d.getElementById('dey_sel');
        var rezult = "";
        for (i = 0; i < rows.length; i++) {
            var d_list = rows[i].cells[1].innerText.split("."); // дату разбили на день месяц год	
            var dt = new Date(d_list[2], d_list[1] - 1 + 11, d_list[0] * 1);
            if (ob.value == getWeekDay(dt))
                rezult += rows[i].cells[0].innerText + "  -  " + rows[i].cells[1].innerText + " ;<br>";
        }
        if (rezult == "")
            rezult = "Ничего не найдено";
        d.getElementById('dey_sel_rez').innerHTML = rezult;
        return true;
    }   
</script>

<H1>Лабораторная 4</H1> <br> <br>
<br>
В анкете заполняется информация о сотрудниках: фамилия, дата заключения контракта,
продолжительность отпуска. Ровно через одиннадцать месяцев после начала работы сотрудникам
предоставляется отпуск, продолжительность которого оговорена в контракте (12, 24, 30, 48, 60
дней). Напишите сценарий, определяющий:
<ul>   
    <li>дату начала и окончания отпуска для каждого из сотрудников;</li> 
    <li>фамилии сотрудников, начала отпусков которых приходятся на данный месяц (месяц выбирается пользователем)</li> 
    <li>в зависимости от введенной пользователем даты фамилии сотрудников, которым предоставлен отпуск.</li>

</ul>  
<br>
<H2>информация о сотрудниках</H2>

<form action="" id="add_persons" method="post" onsubmit="addRow();return false;" onsubmit="addRowAndOtp();return false;">
    <fieldset>
        <legend>Добавить сотрудника</legend>
        <ul>
            <li>
                <label for="name">Фамилия Имя Отчество</label>
                <input type="text" name="name" id="name" value="" size="12" required="" tabindex="1" />
            </li>
            <li>
                <label for="posada">Дата заклюения контракта</label>
                <input type="text" name="data" id="data" value="" required="" size="12" tabindex="2" />
            </li>
            <li>
                <label for="subm">Продолжительность отпуска</label>
                <select type="number" name="srok" id="srok" tabindex="3">
                    <option>12</option>
                    <option>24</option>
                    <option>30</option>
                    <option>48</option>
                    <option>60</option> 
                </select> дней              
            </li>
        </ul>
        <br>
        <input type="submit" value="Добавить" tabindex="4" />
        <br> день недели, в который закончится контракт -
        <div id="w_dey"></div>

    </fieldset>
</form>
<br>

<H2>Cписок сотрудников</H2>

<table id="tab1" border="1">
    <thead>
        <tr>
            <th>Фамилия Имя Отчество</th>
            <th>Дата заклюения контракта</th>
            <th>Продолжительность отпуска</th>
            <th>Начало отпуска</th>
            <th>Конец отпуска</th>
        </tr>
    </thead>
    <tbody>     
    </tbody>
</table>
<br><br> Начало отпуска приходятся на  
<select id="dey_sel" onchange="startVacationInMonth()">
    <option value="-1"></option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
</select>месяц:
<br><br>
<div id="dey_sel_rez"></div>
<br>
<br>

<label for="dataVacation">В зависимости от введенной пользователем даты</label>
<input type="text" name="dataVacation" id="dataVacation" value="01.02.2018" required="" size="12" tabindex="2" />
<button type="button" onclick="searchPiopleInVacation();">поиск</button>
<br>
Фамилии сотрудников, которым предоставлен отпуск 
<br>
(дата начала меньше указанной даты, а указанная дата меньше даты конца отпуска)

<table id="tab11" border="1">
    <thead>
        <tr>
            <th>Фамилия Имя Отчество</th>
            <th>Дата заклюения контракта</th>
            <th>Продолжительность отпуска</th>
            <th>Начало отпуска</th>
            <th>---</th>
            <th>Конец отпуска</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>
<br>

<script>
    d.getElementById('data').value = formatDate(new Date());
    d.getElementById('dataVacation').value = formatDate(new Date());
</script>


    
</body>
</html>